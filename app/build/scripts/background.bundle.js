!function t(e,n,r){function o(u,s){if(!n[u]){if(!e[u]){var c="function"==typeof require&&require;if(!s&&c)return c(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+u+"'")}var p=n[u]={exports:{}};e[u][0].call(p.exports,function(t){var n=e[u][1][t];return o(n?n:t)},p,p.exports,t,e,n,r)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<r.length;u++)o(r[u]);return o}({1:[function(t){var e,n,r,o=function(t,e){return function(){return t.apply(e,arguments)}},i={}.hasOwnProperty,u=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=t("../../common.coffee"),e=function(t){function e(){return this.findFileForQueryString=o(this.findFileForQueryString,this),this.findFileForPath=o(this.findFileForPath,this),this.getLocalFile=o(this.getLocalFile,this),e.__super__.constructor.apply(this,arguments)}return u(e,t),e.prototype.retainedDirs={},e.prototype.init=function(){return this.Storage.retrieveAll(function(t){return function(){return t.data=t.Storage.data,null!=t.Storage.data.server&&(t.Storage.data.server={}),t.maps=t.data.maps}}(this)),this.Server.getLocalFile=this.getLocalFile,this.LISTEN.Local("startServer",function(t){return function(){return t.startServer()}}(this)),this.LISTEN.Ext("startServer",function(t){return function(){return t.startServer(function(){return t.Storage.saveAllAndSync()})}}(this)),this.LISTEN.Local("stopServer",function(t){return function(){return t.stopServer()}}(this)),this.LISTEN.Ext("stopServer",function(t){return function(){return t.stopServer(function(){return t.Storage.saveAllAndSync()})}}(this))},e.prototype.cleanUp=function(){return this.stopServer()},e.prototype.getMatchingResources=function(){var t,e,n,r,o,i;for(t=[],i=this.data.currentResources,n=function(e){return function(n){var r,o,i,u,s;for(u=e.maps,s=[],o=0,i=u.length;i>o;o++)r=u[o],null!=n.url.match(new RegExp(r.url))&&null!=r.url&&s.push(function(){return t.push(n)}(r));return s}}(this),r=0,o=i.length;o>r;r++)e=i[r],n(e);return t},e.prototype.getLocalFile=function(t,e,n){var r,o,i,u;return u=t.uri,u=u.substring(1),i=u,r=this.Storage.data.directories[this.Storage.data.currentMap.directory],null==r?n("no match"):null!=this.retainedDirs[r.directoryEntryId]?(o=this.retainedDirs[r.directoryEntryId],this.FS.readFile(o,i,function(){return function(t,n){return"function"==typeof e?e(t,n):void 0}}(this),function(){return function(t){return n(t)}}(this))):chrome.fileSystem.restoreEntry(r.directoryEntryId,function(t){return function(o){return t.retainedDirs[r.directoryEntryId]=o,t.FS.readFile(o,i,function(t,n){return"function"==typeof e?e(t,n):void 0},function(t){return n(t)},function(t){return n(t)})}}(this))},e.prototype.findFileForPath=function(t,e,n){return this.findFileForQueryString(t.uri,e,n,t.referer)},e.prototype.findFileForQueryString=function(t,e,n,r){var o,i,u,s,c,p,a,l,f,h;for(p=decodeURIComponent(t).replace(/.*?slredir\=/,""),f=this.maps,a=0,l=f.length;l>a;a++)s=f[a],null==p.match(new RegExp(s.url))||null==s.url||"undefined"!=typeof c&&null!==c||(c=s);return null!=c?(u=null!=r?null!=(h=p.match(/.*\/\/.*?\/(.*)/))?h[1]:void 0:p.replace(new RegExp(c.url),c.regexRepl),"win"===platform&&u.replace("/","\\"),o=this.Storage.data.directories[c.directory],null==o?err("no match"):null!=this.retainedDirs[o.directoryEntryId]?(i=this.retainedDirs[o.directoryEntryId],this.FS.readFile(i,u,function(){return function(t,n){return"function"==typeof e?e(t,n):void 0}}(this),function(){return function(t){return t()}}(this))):chrome.fileSystem.restoreEntry(o.directoryEntryId,function(t){return function(n){return t.retainedDirs[o.directoryEntryId]=n,t.FS.readFile(n,u,function(t,n){return"function"==typeof e?e(t,n):void 0},function(t){return t()},function(t){return t()})}}(this))):n()},e.prototype.startServer=function(t,e){return this.Server.stopped===!0?this.Server.start(null,null,null,function(e){return function(){return e.MSG.Local({server:e.Server}),e.data.server={url:"http://"+e.Server.host+":"+e.Server.port+"/",isOn:!0},e.Notify("Server Started","Started Server http://"+e.Server.host+":"+e.Server.port),"function"==typeof t?t():void 0}}(this),function(t){return function(n){return t.Notify("Server Error","Error Starting Server: "+n),t.data.server={url:"http://"+t.Server.host+":"+t.Server.port+"/",isOn:!0},"function"==typeof e?e():void 0}}(this)):void 0},e.prototype.stopServer=function(){return this.Server.stop(function(t){return function(){return t.Notify("Server Stopped","Server Stopped"),t.MSG.Local({server:null}),t.data.server={url:"",isOn:!1}}}(this),function(t){return function(e){return t.Notify("Server Error","Server could not be stopped: "+e)}}(this))},e}(n),r=new e},{"../../common.coffee":2}],2:[function(t,e){var n,r,o,i,u,s,c,p,a,l,f={}.hasOwnProperty,h=function(t,e){function n(){this.constructor=t}for(var r in e)f.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},d=function(t,e){return function(){return t.apply(e,arguments)}};!function(){var t,e;return t=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],e=function(){var n,r,o,i;for(i=[],r=0,o=t.length;o>r;r++)n=t[r],console[n]||i.push(console[n]=e);return i},window.show=null!=Function.prototype.bind?Function.prototype.bind.call(console.log,console):function(){return Function.prototype.apply.call(console.log,console,arguments)}}(),p=function(){function t(){}return t.prototype.show=function(t,e){var n;return n=function(t){var e;for(null==t&&(t=8),e="";e.length<t;)e+=Math.random().toString(36).substr(2);return e.substr(0,t)},chrome.notifications.create(n(),{type:"basic",title:t,message:e,iconUrl:"images/icon-38.png"},function(){return void 0})},t}(),r=function(){function t(){this.EXT_ID=this.APP_ID===this.SELF_ID?this.EXTENSION_ID:this.APP_ID,this.EXT_TYPE=this.APP_ID!==this.SELF_ID?"EXTENSION":"APP"}return t.prototype.APP_ID="denefdoofnkgjmpbfpknihpgdhahpblh",t.prototype.EXTENSION_ID="ijcjmpejonmimoofbcpaliejhikaeomh",t.prototype.SELF_ID=chrome.runtime.id,t}(),s=function(t){function e(){e.__super__.constructor.apply(this,arguments)}var n;return h(e,t),e.prototype.isContentScript="chrome-extension:"!==location.protocol,n=null,e.get=function(){return null!=n?n:n=new e},e.prototype.Local=function(t,e){var n;for(n in t)show("== MESSAGE "+n+" ==>");return chrome.runtime.sendMessage(t,e)},e.prototype.Ext=function(t,e){var n;for(n in t)show("== MESSAGE EXTERNAL "+n+" ==>");return chrome.runtime.sendMessage(this.EXT_ID,t,e)},e}(r),u=function(t){function e(){this._onMessage=d(this._onMessage,this),this._onMessageExternal=d(this._onMessageExternal,this),this.Ext=d(this.Ext,this),this.Local=d(this.Local,this);var t;e.__super__.constructor.apply(this,arguments),this.local.api.addListener(this._onMessage),null!=(t=this.external.api)&&t.addListener(this._onMessageExternal)}var n;return h(e,t),e.prototype.local={api:chrome.runtime.onMessage,listeners:{}},e.prototype.external={api:chrome.runtime.onMessageExternal,listeners:{}},n=null,e.get=function(){return null!=n?n:n=new e},e.prototype.Local=function(t,e){return this.local.listeners[t]=e},e.prototype.Ext=function(t,e){return show("adding ext listener for "+t),this.external.listeners[t]=e},e.prototype._onMessageExternal=function(t,e,n){var r,o,i,u;for(i in t)show("<== GOT EXTERNAL MESSAGE == "+this.EXT_TYPE+" =="+i);if(e.id!==this.EXT_ID)return void 0;u=[];for(r in t)u.push("function"==typeof(o=this.external.listeners)[r]?o[r](t[r],n):void 0);return u},e.prototype._onMessage=function(t,e,n){var r,o,i,u;for(i in t)show("<== GOT MESSAGE == "+this.EXT_TYPE+" =="+i);u=[];for(r in t)u.push("function"==typeof(o=this.local.listeners)[r]?o[r](t[r],n):void 0);return u},e}(r),o=function(){function t(){}return t.prototype.mapping=[{directory:null,urlPattern:null}],t.prototype.resources=[{resource:null,file:null}],t}(),l=function(){function t(t){this.callback=t,this.retrieveAll(),this.onChangedAll(),this.LISTEN.Ext("storageData",function(t){return function(e){var n,r,o;n=!1,o=function(r){return show("saving result"+r),t.data[r]!==e[r]?(t.data[r]=e[r],show("changes "+r),n=!0):void 0};for(r in e)o(r);return t.saveAll()}}(this))}return t.prototype.api=chrome.storage.local,t.prototype.LISTEN=u.get(),t.prototype.MSG=s.get(),t.prototype.data={},t.prototype.callback=function(){},t.prototype.save=function(t,e,n){var r;return r={},r[t]=e,this.data[t]=e,this.api.set(r,function(t){return function(){return"function"==typeof n&&n(),"function"==typeof t.callback?t.callback():void 0}}(this))},t.prototype.saveAllAndSync=function(t){return this.saveAll(t,function(t){return function(){return t.MSG.Ext({storageData:t.data})}}(this))},t.prototype.saveAll=function(t,e){return null!=t?this.api.set(t,function(){return function(){return"function"==typeof e?e():void 0}}(this)):this.api.set(this.data,function(){return function(){return"function"==typeof e?e():void 0}}(this))},t.prototype.retrieve=function(t,e){return this.api.get(t,function(n){var r;for(r in n)this.data[r]=n[r];return null!=e?e(n[t]):void 0})},t.prototype.retrieveAll=function(t){return this.api.get(function(e){return function(n){return e.data=n,"function"==typeof t&&t(n),show(n)}}(this))},t.prototype.onChanged=function(t,e){return chrome.storage.onChanged.addListener(function(n){return null!=n[t]&&null!=e&&e(n[t].newValue),"function"==typeof this.callback?this.callback(n):void 0})},t.prototype.onChangedAll=function(){return chrome.storage.onChanged.addListener(function(t){return function(e){var n,r;r=!1;for(n in e)e[n].newValue!==e[n].oldValue&&"socketIds"!==n;return r&&"function"==typeof t.callback&&t.callback(e),r?show("changed"):void 0}}(this))},t}(),i=function(){function t(){this.openDirectory=d(this.openDirectory,this)}return t.prototype.api=chrome.fileSystem,t.prototype.readFile=function(t,e,n,r){return this.getFileEntry(t,e,function(){return function(t){return t.file(function(e){return n(t,e)},function(t){return r(t)})}}(this),function(){return function(t){return r(t)}}(this))},t.prototype.getFileEntry=function(t,e,n,r){return null!=(null!=t?t.getFile:void 0)?t.getFile(e,{},function(t){return n(t)},function(){return function(t){return r(t)}}(this)):r()},t.prototype.openDirectory=function(t){return this.api.chooseEntry({type:"openDirectory"},function(e){return function(n){return e.api.getDisplayPath(n,function(r){var o;return o={relPath:n.fullPath.replace("/"+n.name,""),directoryEntryId:e.api.retainEntry(n),entry:n},t(r,o)})}}(this))},t}(),c=function(){function t(t,e,n){var r;r=[e,t,n],this.local=r[0],this.resource=r[1],this.regex=r[2]}return t.prototype.resource=null,t.prototype.local=null,t.prototype.regex=null,t.prototype.getLocalResource=function(){return this.resource.replace(this.regex,this.local)},t.prototype.setRedirectDeclarative=function(){var t;return t=[].push({priority:100,conditions:[new chrome.declarativeWebRequest.RequestMatcher({url:{urlMatches:this.regex}})],actions:[new chrome.declarativeWebRequest.RedirectRequest({redirectUrl:this.getLocalResource()})]}),chrome.declarativeWebRequest.onRequest.addRules(t)},t}(),a=function(){function t(){this._onAccept=d(this._onAccept,this),this._onListen=d(this._onListen,this),this._onReceive=d(this._onReceive,this)}return t.prototype.socket=chrome.socket,t.prototype.host="127.0.0.1",t.prototype.port=8089,t.prototype.maxConnections=500,t.prototype.socketProperties={persistent:!0,name:"SLRedirector"},t.prototype.socketInfo=null,t.prototype.getLocalFile=null,t.prototype.socketIds=[],t.prototype.stopped=!0,t.prototype.start=function(t,e,n,r,o){return this.host=null!=t?t:this.host,this.port=null!=e?e:this.port,this.maxConnections=null!=n?n:this.maxConnections,this.killAll(function(t){return function(){return t.socket.create("tcp",{},function(e){return t.socketIds=[],t.socketIds.push(e.socketId),chrome.storage.sync.set({socketIds:t.socketIds}),t.socket.listen(e.socketId,t.host,t.port,function(n){return n>-1?(show("listening "+e.socketId),t.stopped=!1,t.socketInfo=e,t.socket.accept(e.socketId,t._onAccept),"function"==typeof r?r(e):void 0):"function"==typeof o?o(n):void 0})})}}(this),null!=o)},t.prototype.killAll=function(t){return chrome.storage.sync.get("socketIds",function(e){return function(n){var r,o,i,u,s,c;if(show("got ids"),show(n),e.socketIds=n.socketIds,null==e.socketIds)return"function"==typeof t?t():void 0;for(r=0,s=e.socketIds,c=[],i=0,u=s.length;u>i;i++)o=s[i],c.push(function(n){return r++,e.socket.getInfo(n,function(){return r--,null==chrome.runtime.lastError&&(e.socket.disconnect(n),e.socket.destroy(n)),0===r&&"function"==typeof t?t():void 0})}(o));return c}}(this))},t.prototype.stop=function(t){return this.killAll(function(e){return function(){return e.stopped=!0,"function"==typeof t?t():void 0}}(this),function(){return function(t){return"function"==typeof t?t(t):void 0}}(this))},t.prototype._onReceive=function(t){return show("Client socket 'receive' event: sd="+t.socketId,0/0+t.data.byteLength)},t.prototype._onListen=function(t,e){return 0>e?show("Error Listening: "+chrome.runtime.lastError.message):(this.serverSocketId=t,this.tcpServer.onAccept.addListener(this._onAccept),this.tcpServer.onAcceptError.addListener(this._onAcceptError),this.tcp.onReceive.addListener(this._onReceive))},t.prototype._onAcceptError=function(t){return show(t)},t.prototype._onAccept=function(t){return show("Server socket 'accept' event: sd="+t.socketId),null!=(null!=t?t.socketId:void 0)?this._readFromSocket(t.socketId,function(e){return function(n){return e.getLocalFile(n,function(r,o){return e._write200Response(t.socketId,r,o,n.keepAlive)},function(){return e._writeError(t.socketId,404,n.keepAlive)})}}(this)):show("No socket?!")},t.prototype.stringToUint8Array=function(t){var e,n,r;for(e=new ArrayBuffer(t.length),r=new Uint8Array(e),n=0;n<t.length;)r[n]=t.charCodeAt(n),n++;return r},t.prototype.arrayBufferToString=function(t){var e,n,r;for(n="",r=new Uint8Array(t),e=0;e<r.length;)n+=String.fromCharCode(r[e]),e++;return n},t.prototype._write200Response=function(t,e,n,r){var o,i,u,s,c,p;return i=""===n.type?"text/plain":n.type,o=n.size,u=this.stringToUint8Array("HTTP/1.0 200 OK\nContent-length: "+n.size+"\nContent-type:"+i+(r?"\nConnection: keep-alive":"")+"\n\n"),s=new ArrayBuffer(u.byteLength+n.size),p=new Uint8Array(s),p.set(u,0),c=new FileReader,c.onload=function(e){return function(n){return p.set(new Uint8Array(n.target.result),u.byteLength),e.socket.write(t,s,function(n){return show(n),e.end(t,r)})}}(this),c.onerror=function(e){return function(){return e.end(t,r)}}(this),c.readAsArrayBuffer(n)},t.prototype._readFromSocket=function(t,e){return this.socket.read(t,function(n){return function(r){var o,i,u,s,c,p;return show("READ",r),o=n.arrayBufferToString(r.data),show(o),0!==o.indexOf("GET ")?void n.end(t):(u=!1,o.indexOf(!0)&&(u=!0),c=o.indexOf(" ",4),0>c?end(t):(s=o.substring(4,c),null==s?void writeError(t,404,u):(i={uri:s,keepAlive:u},i.referer=null!=(p=o.match(/Referer:\s(.*)/))?p[1]:void 0,"function"==typeof e?e(i):void 0)))}}(this))},t.prototype.end=function(t){return this.socket.disconnect(t),this.socket.destroy(t),show("ending "+t),this.socket.accept(this.socketInfo.socketId,this._onAccept)},t.prototype._writeError=function(t,e,n){var r,o,i,u,s,c;return i={size:0},o="text/plain",r=i.size,u=this.stringToUint8Array("HTTP/1.0 "+e+" Not Found\nContent-length: "+i.size+"\nContent-type:"+o+(n?"\nConnection: keep-alive":"")+"\n\n"),s=new ArrayBuffer(u.byteLength+i.size),c=new Uint8Array(s),c.set(u,0),this.socket.write(t,s,function(e){return function(r){return show("WRITE",r),e.end(t,n)}}(this))},t}(),n=function(t){function e(){this.openApp=d(this.openApp,this),this.init=d(this.init,this),this.MSG=s.get(),this.LISTEN=u.get(),this.Notify=(new p).show,this.Storage=new l,this.FS=new i,this.Server=new a,this.data=this.Storage.data,this.appWindow=null,this.port=31337,this.LISTEN.Ext("openApp",this.openApp),this.LISTEN.Ext("getData",function(t){return function(e,n){return n(t.data)}}(this)),chrome.runtime.getPlatformInfo(function(t){return function(e){return t.platform=e}}(this)),this.init()}return h(e,t),e.prototype.data=null,e.prototype.LISTEN=null,e.prototype.MSG=null,e.prototype.Storage=null,e.prototype.FS=null,e.prototype.Server=null,e.prototype.Notify=null,e.prototype.platform=null,e.prototype.init=function(){},e.prototype.launchUI=function(t,e){return this.launchApp(function(e){return function(n){return e.openApp(),"function"==typeof t?t(n):void 0}}(this),e)},e.prototype.launchApp=function(t,e){return chrome.management.launchApp(this.APP_ID,function(){return function(n){return chrome.runtime.lastError?e(chrome.runtime.lastError):"function"==typeof t?t(n):void 0}}(this))},e.prototype.openApp=function(){var t;return null!=(null!=(t=chrome.app)?t.window:void 0)?chrome.app.window.create("index.html",{id:"mainwin",bounds:{width:641,height:800}},function(t){return function(e){return t.appWindow=e}}(this)):this.MSG.Ext({openApp:!0})},e}(r),e.exports=n},{}]},{},[1]);